<html>

<head>
    <link href='https://fonts.googleapis.com/css?family=Overpass+Mono' rel='stylesheet'>
    
    <link rel="stylesheet" type="text/css" href="style/style.css" media="screen" />

    <style>

        #code {
            overflow: scroll;
            height: 100%;
        }

        li {
            font-family: 'Overpass Mono', monospace;
            font-size: 13px;
            line-height: 120%;
            list-style: none;
        }

        li:hover {
            background: #606060;
        }

        .listing {
            background: #303030;
        }
    </style>

    <script>

        var selected = []
        var current_selection = null

        function copy() {
            var aux = document.createElement('input')
            aux.setAttribute('value', document.getElementById('code').innerText)
            document.body.appendChild(aux)
            aux.select()
            document.execCommand('copy')
            document.body.removeChild(aux)
        }

        function add(item) {
            if (selected.includes(item)) {
                return
            }

            selected.push(item)

            var html = make_ul(selected, 'select')
            document.getElementById('selection-list').innerHTML = html
        }

        function remove(item) {
            current_selection = item
            selected.splice(selected.indexOf(item), 1)

            var html = make_ul(selected, 'select')
            document.getElementById('selection-list').innerHTML = html
        }

        function show(item) {
            var url = 'https://raw.githubusercontent.com/n1LS/assembler/master/warriors/' + item.trim();
            var file = new XMLHttpRequest();

            file.onreadystatechange = function () {

                if (file.readyState == 4 && file.status == 200) {
                    document.getElementById('code').innerText = file.responseText
                }
            }

            file.open('GET', url, true);
            file.send();
        }

        function select(item) {
            if (current_selection === item) {
                remove(item)
            }
            else {
                show(item)
                current_selection = item
            }
        }

        function make_ul(items, function_name) {
            var s = '<ul>'

            for (var i = 0; i
                < items.length; i++) {
                s += (`<li onclick='${function_name}(" ${items[i]}" )'>${items[i]}</li>`)
            }

            s += '</ul>'

            return s
        }
    </script>
</head>

<body>

    <div class='top'>

        <div class='left30'>

            <h1>Public warriors:</h1>
            <div class='listing' id='public'></div>

            <script>
                // load remote warriors
                setTimeout(function () {
                    var url = 'https://raw.githubusercontent.com/n1LS/assembler/master/warriors/listing.txt';
                    var file = new XMLHttpRequest();

                    file.onreadystatechange = function () {

                        if (file.readyState == 4 && file.status == 200) {
                            var items = file.responseText.split('\n')

                            document.getElementById('public').innerHTML = make_ul(items, 'add')
                        }
                    }

                    file.open('GET', url, true);
                    file.send();
                }, 1)
            </script>

            <h1>Local:</h1>
            <div class='listing' id='local'></div>

            <script>
                // load local warriors
                var items = []

                for (var i = 0; i
                    < localStorage.length; i++) {
                    var key = localStorage.key(i)

                    if (key.startsWith('#WRRR_')) {
                        items.push(key)
                    }
                }

                document.getElementById('local').innerHTML = make_ul(items,
                    'add')

            </script>

            <h1>Selected:</h1>
            <div class='listing' id='selection-list'></div>
        </div>
        <div class='left70'>
            <pre id='code'></pre>
        </div>
    </div>
    <div class='toolbar'>
        <input type='button' value='copy to clipboard' onclick='copy()'>
    </div>
</body>

</html>